"use strict";(self.webpackChunkcontrol_financiero_frontend=self.webpackChunkcontrol_financiero_frontend||[]).push([[526],{562:(M,D,i)=>{i.d(D,{Y:()=>b});var g=i(1626),_=i(4412),d=i(8810),f=i(8141),l=i(9437),u=i(5312),E=i(4438);let b=(()=>{class p{constructor(r){this.http=r,this.apiUrl=`${u.c.apiUrl}/fondos`,this.fondosSubject=new _.t([]),this.fondos$=this.fondosSubject.asObservable()}obtenerFondos(r){console.log("\u{1f3e6} Obteniendo fondos del backend...");let o=new g.Nl;return r&&(o=o.set("tipo",r)),this.http.get(this.apiUrl,{params:o}).pipe((0,f.M)(e=>{console.log("\u2705 Fondos obtenidos exitosamente:",e),this.fondosSubject.next(e),localStorage.setItem("fondos_cache",JSON.stringify(e))}),(0,l.W)(e=>{console.error("\u274c Error al obtener fondos - NO se usar\xe1n datos simulados:",e);let a="Error al cargar fondos";return 0===e.status?a="No se puede conectar con el servidor. Verifica que el backend est\xe9 ejecut\xe1ndose.":401===e.status?a="No autorizado. Tu sesi\xf3n puede haber expirado.":500===e.status&&(a="Error del servidor. Verifica que MongoDB est\xe9 ejecut\xe1ndose."),(0,d.$)(()=>({...e,message:a}))}))}obtenerFondoPorId(r){return this.http.get(`${this.apiUrl}/${r}`).pipe((0,l.W)(o=>{throw console.error("Error al obtener fondo:",o),o}))}crearFondo(r){return console.log("\u{1f4be} Creando nuevo fondo:",r),this.http.post(this.apiUrl,r).pipe((0,f.M)(o=>{console.log("\u2705 Fondo creado exitosamente:",o),this.fondosSubject.next([...this.fondosSubject.value,o])}),(0,l.W)(o=>{console.error("\u274c Error al crear fondo:",o);let e="Error al crear el fondo";return 400===o.status?e=o.error?.message||"Datos del fondo inv\xe1lidos":401===o.status?e="No autorizado para crear fondos":500===o.status&&(e="Error del servidor. Verifica que MongoDB est\xe9 ejecut\xe1ndose."),(0,d.$)(()=>({...o,message:e}))}))}actualizarFondo(r,o){return console.log("\u270f\ufe0f Actualizando fondo:",r,o),this.http.patch(`${this.apiUrl}/${r}`,o).pipe((0,f.M)(e=>{console.log("\u2705 Fondo actualizado exitosamente:",e);const a=this.fondosSubject.value,t=a.findIndex(s=>s._id===r);-1!==t&&(a[t]=e,this.fondosSubject.next([...a]))}),(0,l.W)(e=>{console.error("\u274c Error al actualizar fondo:",e);let a="Error al actualizar el fondo";return 400===e.status?a=e.error?.message||"Datos del fondo inv\xe1lidos":404===e.status?a="Fondo no encontrado":401===e.status&&(a="No autorizado para editar este fondo"),(0,d.$)(()=>({...e,message:a}))}))}eliminarFondo(r){return console.log("\u{1f5d1}\ufe0f Eliminando fondo:",r),this.http.delete(`${this.apiUrl}/${r}`).pipe((0,f.M)(o=>{console.log("\u2705 Fondo eliminado exitosamente:",o);const a=this.fondosSubject.value.filter(t=>t._id!==r);this.fondosSubject.next(a)}),(0,l.W)(o=>{console.error("\u274c Error al eliminar fondo:",o);let e="Error al eliminar el fondo";return 404===o.status?e="Fondo no encontrado":401===o.status&&(e="No autorizado para eliminar este fondo"),(0,d.$)(()=>({...o,message:e}))}))}obtenerEstadisticasFondo(r){return this.http.get(`${this.apiUrl}/${r}/estadisticas`).pipe((0,l.W)(o=>{throw console.error("Error al obtener estad\xedsticas:",o),o}))}obtenerEstadisticasGenerales(){return this.http.get(`${this.apiUrl}/estadisticas`).pipe((0,l.W)(r=>{throw console.error("Error al obtener estad\xedsticas generales:",r),r}))}obtenerTiposFondo(){return["registro","ahorro"]}static{this.\u0275fac=function(o){return new(o||p)(E.KVO(g.Qq))}}static{this.\u0275prov=E.jDH({token:p,factory:p.\u0275fac,providedIn:"root"})}}return p})()},5435:(M,D,i)=>{i.d(D,{j:()=>p});var g=i(1626),_=i(4412),d=i(7673),f=i(6354),l=i(8141),u=i(9437),E=i(5312),b=i(4438);let p=(()=>{class m{constructor(o){this.http=o,this.apiUrl=`${E.c.apiUrl}/transacciones`,this.transaccionesSubject=new _.t([]),this.estadisticasSubject=new _.t(null),this.transacciones$=this.transaccionesSubject.asObservable(),this.estadisticas$=this.estadisticasSubject.asObservable()}obtenerTransacciones(o={}){let e=new g.Nl;return console.log("\u{1f4cb} Frontend - Filtros recibidos:",o),Object.keys(o).forEach(a=>{const t=o[a];null!=t&&""!==t&&(Array.isArray(t)?t.forEach(s=>e=e.append(a,s)):e=e.set(a,t.toString()))}),console.log("\u{1f310} Frontend - Par\xe1metros HTTP enviados:",e.toString()),console.log("\u{1f310} Frontend - URL completa:",`${this.apiUrl}?${e.toString()}`),this.http.get(this.apiUrl,{params:e}).pipe((0,f.T)(a=>{const t=a.transacciones?.map(s=>({...s,fondoId:"object"==typeof s.fondoId&&s.fondoId._id?s.fondoId._id:s.fondoId,_fondoNombre:"object"==typeof s.fondoId&&s.fondoId.nombre?s.fondoId.nombre:null}))||[];return{transacciones:t,total:a.total||t.length,page:a.page||1,totalPages:a.totalPages||1,resumen:a.resumen}}),(0,l.M)(a=>{console.log("\u2705 Transacciones del backend transformadas:",a),this.transaccionesSubject.next(a.transacciones),a.resumen&&this.actualizarEstadisticas(a.resumen)}),(0,u.W)(a=>(console.error("\u274c Error al obtener transacciones del backend:",a),0===a.status?(console.log("\u{1f4ca} Usando datos simulados como fallback por error de conexi\xf3n..."),this.generarDatosSimulados(o)):(0,d.of)({transacciones:[],total:0,page:1,totalPages:0}))))}obtenerTransaccionPorId(o){return this.http.get(`${this.apiUrl}/${o}`).pipe((0,u.W)(e=>{throw console.error("Error al obtener transacci\xf3n:",e),e}))}crearTransaccion(o){return this.http.post(this.apiUrl,o).pipe((0,l.M)(e=>{this.transaccionesSubject.next([e,...this.transaccionesSubject.value])}),(0,u.W)(e=>{throw console.error("Error al crear transacci\xf3n:",e),e}))}crearTransferencia(o){return console.log("\u{1f504} Frontend - Creando transferencia:",o),console.log("\u{1f310} Frontend - URL de transferencia:",`${this.apiUrl}/transferencia`),console.log("\u{1f310} Frontend - API Base URL:",this.apiUrl),this.http.post(`${this.apiUrl}/transferencia`,o).pipe((0,l.M)(e=>{console.log("\u2705 Frontend - Transferencia creada exitosamente:",e),this.transaccionesSubject.next([e.transaccionOrigen,e.transaccionDestino,...this.transaccionesSubject.value])}),(0,u.W)(e=>{console.error("\u274c Frontend - Error al crear transferencia:",e),console.error("\u274c Frontend - Error status:",e.status),console.error("\u274c Frontend - Error URL:",e.url),console.error("\u274c Frontend - Error message:",e.message);let a="Error al crear la transferencia";throw 400===e.status?a=e.error?.message||"Datos de transferencia inv\xe1lidos o saldo insuficiente":404===e.status?a="Endpoint de transferencias no encontrado - Verificar que el backend est\xe9 ejecut\xe1ndose":401===e.status?a="No autorizado para realizar transferencias":0===e.status&&(a="No se puede conectar con el servidor"),{...e,message:a}}))}actualizarTransaccion(o,e){return console.log("\u{1f504} Frontend - Actualizando transacci\xf3n:",{id:o,transaccion:e}),console.log("\u{1f504} Frontend - URL completa:",`${this.apiUrl}/${o}`),this.http.patch(`${this.apiUrl}/${o}`,e).pipe((0,l.M)(a=>{console.log("\u2705 Frontend - Transacci\xf3n actualizada exitosamente:",a);const t=this.transaccionesSubject.value,s=t.findIndex(I=>I._id===o);-1!==s?(t[s]=a,this.transaccionesSubject.next([...t]),console.log("\u2705 Frontend - Lista de transacciones actualizada")):console.warn("\u26a0\ufe0f Frontend - No se encontr\xf3 la transacci\xf3n en la lista local para actualizar")}),(0,u.W)(a=>{console.error("\u274c Frontend - Error al actualizar transacci\xf3n:",a),console.error("\u274c Frontend - Error detalles:",{status:a.status,statusText:a.statusText,message:a.message,url:a.url});let t="Error al actualizar la transacci\xf3n";throw 404===a.status?t="Transacci\xf3n no encontrada":401===a.status?t="No autorizado para editar esta transacci\xf3n":400===a.status?t=a.error?.message||"Datos de la transacci\xf3n inv\xe1lidos":0===a.status&&(t="No se puede conectar con el servidor"),{...a,message:t}}))}eliminarTransaccion(o){return console.log("\u{1f5d1}\ufe0f Eliminando transacci\xf3n:",o),this.http.delete(`${this.apiUrl}/${o}`).pipe((0,l.M)(e=>{console.log("\u2705 Transacci\xf3n eliminada exitosamente:",e);const t=this.transaccionesSubject.value.filter(s=>s._id!==o);this.transaccionesSubject.next(t)}),(0,u.W)(e=>{throw console.error("\u274c Error al eliminar transacci\xf3n:",e),e}))}obtenerCategorias(){return["necesario","no_necesario","salario","regalo","otros","transferencia"]}obtenerCategoriasPorTipo(o){return"gasto"===o?["necesario","no_necesario"]:"ingreso"===o?["salario","regalo","otros"]:"transferencia"===o?["transferencia"]:[]}actualizarEstadisticas(o){this.estadisticasSubject.next({totalTransacciones:o.totalIngresos+o.totalGastos,totalIngresos:o.totalIngresos,totalGastos:o.totalGastos,balance:o.totalIngresos-o.totalGastos,promedioTransacciones:0,categoriaMaxGasto:{categoria:"",monto:0},categoriaMaxIngreso:{categoria:"",monto:0},tendenciaMensual:[]})}obtenerTransaccionesPorFondo(o,e=10){let a=(new g.Nl).set("limit",e.toString()).set("ordenarPor","fecha").set("orden","desc");return this.http.get(`${this.apiUrl}/fondo/${o}`,{params:a}).pipe((0,f.T)(t=>t.map(s=>({...s,fondoId:"object"==typeof s.fondoId&&s.fondoId._id?s.fondoId._id:s.fondoId,_fondoNombre:"object"==typeof s.fondoId&&s.fondoId.nombre?s.fondoId.nombre:null}))),(0,u.W)(t=>(console.error("\u274c Error al obtener transacciones del fondo:",t),0===t.status?(console.log("\u{1f4ca} Usando datos simulados para el fondo:",o),this.generarDatosSimuladosPorFondo(o,e)):(0,d.of)([]))))}generarDatosSimuladosPorFondo(o,e){const a=[{_id:`trans_${o}_1`,fondoId:o,descripcion:"Compras del supermercado",monto:15e4,tipo:"gasto",categoria:"necesario",fecha:new Date,notas:"Compras semanales"},{_id:`trans_${o}_2`,fondoId:o,descripcion:"Salario mensual",monto:5e5,tipo:"ingreso",categoria:"salario",fecha:new Date(Date.now()-864e5),notas:"Dep\xf3sito inicial del fondo"},{_id:`trans_${o}_3`,fondoId:o,descripcion:"Entretenimiento - Cine",monto:25e3,tipo:"gasto",categoria:"no_necesario",fecha:new Date(Date.now()-1728e5)},{_id:`trans_${o}_4`,fondoId:o,descripcion:"Regalo de cumplea\xf1os",monto:2e5,tipo:"ingreso",categoria:"regalo",fecha:new Date(Date.now()-2592e5)},{_id:`trans_${o}_5`,fondoId:o,descripcion:"Venta de art\xedculos",monto:35e3,tipo:"ingreso",categoria:"otros",fecha:new Date(Date.now()-3456e5)}];return(0,d.of)(a.slice(0,e))}generarDatosSimulados(o){console.log("\u{1f4ca} Generando datos simulados de transacciones..."),console.log("\u{1f4ca} Filtros aplicados a datos simulados:",o);let e=[];try{const n=localStorage.getItem("fondos_cache");n&&(e=JSON.parse(n),console.log("\u{1f4e6} Fondos desde cache:",e))}catch{console.warn("Error leyendo cache de fondos")}const a=e[0]?._id||"685393a3a9540bbd42b8aa7a",t=e[1]?._id||"685393a3a9540bbd42b8aa7b",s=e[2]?._id||"685393a3a9540bbd42b8aa7c";console.log("\u{1f3e6} Usando fondoIds:",{fondoId1:a,fondoId2:t,fondoId3:s});const I=[{_id:"trans_1",fondoId:a,descripcion:"Compras del supermercado",monto:15e4,tipo:"gasto",categoria:"necesario",fecha:new Date,notas:"Compras semanales",etiquetas:["supermercado","semanal"]},{_id:"trans_2",fondoId:t,descripcion:"Salario mensual",monto:25e5,tipo:"ingreso",categoria:"salario",fecha:new Date,etiquetas:["trabajo","mensual"]},{_id:"trans_3",fondoId:a,descripcion:"Videojuegos",monto:45e3,tipo:"gasto",categoria:"no_necesario",fecha:new Date,notas:"Entretenimiento"},{_id:"trans_4",fondoId:s,descripcion:"Regalo familiar",monto:8e5,tipo:"ingreso",categoria:"regalo",fecha:new Date,etiquetas:["familia","especial"]},{_id:"trans_5",fondoId:t,descripcion:"Venta de productos",monto:85e3,tipo:"ingreso",categoria:"otros",fecha:new Date},{_id:"trans_6",fondoId:s,descripcion:"Medicamentos",monto:75e3,tipo:"gasto",categoria:"necesario",fecha:new Date(Date.now()-864e5)}];console.log("\u{1f4ca} Transacciones antes de filtros:",I.map(n=>({desc:n.descripcion,fondoId:n.fondoId})));let c=I;o.tipo&&(console.log("\u{1f504} Aplicando filtro tipo:",o.tipo),c=c.filter(n=>n.tipo===o.tipo)),o.categoria&&(console.log("\u{1f504} Aplicando filtro categor\xeda:",o.categoria),c=c.filter(n=>n.categoria===o.categoria)),o.fondoId&&(console.log("\u{1f504} Aplicando filtro fondo:",o.fondoId),console.log("\u{1f504} Transacciones antes del filtro de fondo:",c.map(n=>({desc:n.descripcion,fondoId:n.fondoId}))),c=c.filter(n=>n.fondoId===o.fondoId),console.log("\u{1f504} Transacciones despu\xe9s del filtro de fondo:",c.map(n=>({desc:n.descripcion,fondoId:n.fondoId}))));const h={transacciones:c,total:c.length,page:o.page||1,totalPages:Math.ceil(c.length/(o.limit||10)),resumen:{totalIngresos:c.filter(n=>"ingreso"===n.tipo).reduce((n,j)=>n+j.monto,0),totalGastos:c.filter(n=>"gasto"===n.tipo).reduce((n,j)=>n+j.monto,0),balance:0,transaccionesPorCategoria:[]}};return h.resumen.balance=h.resumen.totalIngresos-h.resumen.totalGastos,console.log("\u2705 Transacciones simuladas generadas:",h),console.log("\u{1f3e6} FondoIds en respuesta final:",c.map(n=>n.fondoId)),this.transaccionesSubject.next(h.transacciones),(0,d.of)(h)}static{this.\u0275fac=function(e){return new(e||m)(b.KVO(g.Qq))}}static{this.\u0275prov=b.jDH({token:m,factory:m.\u0275fac,providedIn:"root"})}}return m})()}}]);