"use strict";(self.webpackChunkcontrol_financiero_frontend=self.webpackChunkcontrol_financiero_frontend||[]).push([[36],{7036:(jt,I,c)=>{c.r(I),c.d(I,{ReportesComponent:()=>Nt});var h=c(177),M=c(8498),u=c(9417),x=c(5596),E=c(8834),w=c(9213),y=c(2102),P=c(2798),S=c(5084),v=c(6600),t=c(4438);c(6860),c(9969);let $=(()=>{class n{static{this.\u0275fac=function(a){return new(a||n)}}static{this.\u0275mod=t.$C({type:n})}static{this.\u0275inj=t.G2t({imports:[v.yE,v.yE]})}}return n})();var m=c(9159),D=c(9183);let V=(()=>{class n{static{this.\u0275fac=function(a){return new(a||n)}}static{this.\u0275mod=t.$C({type:n})}static{this.\u0275inj=t.G2t({})}}return n})();var G=c(6939);let z=(()=>{class n{static{this.\u0275fac=function(a){return new(a||n)}}static{this.\u0275mod=t.$C({type:n})}static{this.\u0275inj=t.G2t({imports:[v.yE,V,G.jc]})}}return n})();var F=c(6471),Q=c(6195),U=c(7575),C=c(1806),W=c(1413),T=c(6977),_=c(1626),g=c(7673),p=c(6354),b=c(9437),Y=c(5312);let K=(()=>{class n{constructor(e){this.http=e,this.apiUrl=`${Y.c.apiUrl}/reportes`}obtenerDashboard(e="mes"){console.log(`\u{1f4ca} Obteniendo dashboard completo para per\xedodo: ${e}`);const a=(new _.Nl).set("periodo",e);return this.http.get(`${this.apiUrl}/dashboard`,{params:a}).pipe((0,p.T)(i=>(console.log("\u2705 Dashboard obtenido exitosamente:",i),i)),(0,b.W)(i=>(console.error("\u274c Error al obtener dashboard:",i),(0,g.of)({kpis:{totalIngresos:0,totalGastos:0,utilidadNeta:0,margenUtilidad:0,fondosActivos:0,transaccionesPromedio:0},alertas:[],fondosPerformance:[],reporteMensual:null,reporteAnual:null,estadisticas:null,periodo:e}))))}generarReporteMensual(e,a){console.log(`\u{1f4ca} Generando reporte mensual: ${e}/${a}`);const i=(new _.Nl).set("mes",e.toString()).set("a\xf1o",a.toString());return this.http.get(`${this.apiUrl}/mensual`,{params:i}).pipe((0,p.T)(r=>(console.log("\u2705 Reporte mensual obtenido:",r),r)),(0,b.W)(r=>{console.error("\u274c Error al generar reporte mensual:",r);const s={periodo:`${this.getNombreMes(e)} ${a}`,mes:e,a\u00f1o:a,fondos:[],resumen:{totalIngresos:0,totalGastos:0,balanceNeto:0,transaccionesTotales:0}};return(0,g.of)(s)}))}generarReporteAnual(e){console.log(`\u{1f4c5} Generando reporte anual: ${e}`);const a=(new _.Nl).set("a\xf1o",e.toString());return this.http.get(`${this.apiUrl}/anual`,{params:a}).pipe((0,p.T)(i=>(console.log("\u2705 Reporte anual obtenido:",i),i)),(0,b.W)(i=>(console.error("\u274c Error al generar reporte anual:",i),(0,g.of)({a\u00f1o:e,meses:[],resumenAnual:{totalIngresos:0,totalGastos:0,balanceNeto:0,mejorMes:null,peorMes:null}}))))}obtenerAlertas(){return console.log("\u{1f6a8} Obteniendo alertas financieras..."),this.http.get(`${this.apiUrl}/alertas`).pipe((0,p.T)(e=>(console.log("\u2705 Alertas obtenidas:",e),e)),(0,b.W)(e=>(console.error("\u274c Error al obtener alertas:",e),(0,g.of)([]))))}obtenerEstadisticasGenerales(){return console.log("\u{1f4c8} Obteniendo estad\xedsticas generales..."),this.http.get(`${this.apiUrl}/estadisticas`).pipe((0,p.T)(e=>(console.log("\u2705 Estad\xedsticas obtenidas:",e),e)),(0,b.W)(e=>(console.error("\u274c Error al obtener estad\xedsticas:",e),(0,g.of)({totalFondos:0,totalTransacciones:0,balanceTotal:0,fondoMayorBalance:"N/A",categoriaFrecuente:"N/A",promedioGastoMensual:0,sumaTotalFondos:0}))))}obtenerDatosGraficos(e="mes",a="tendencia"){console.log(`\u{1f4c8} Obteniendo datos de gr\xe1ficos: ${a} - ${e}`);const i=(new _.Nl).set("periodo",e).set("tipo",a);return this.http.get(`${this.apiUrl}/graficos`,{params:i}).pipe((0,p.T)(r=>(console.log("\u2705 Datos de gr\xe1ficos obtenidos:",r),r)),(0,b.W)(r=>(console.error("\u274c Error al obtener datos de gr\xe1ficos:",r),(0,g.of)({message:"Error al cargar datos de gr\xe1ficos"}))))}exportarPDF(e){console.log("\u{1f4c4} Exportando reporte a PDF...");const a=new _.Lr({"Content-Type":"application/json"});return this.http.post(`${this.apiUrl}/exportar/pdf`,e,{headers:a,responseType:"blob"}).pipe((0,p.T)(i=>(console.log("\u2705 PDF generado exitosamente"),i)),(0,b.W)(i=>{throw console.error("\u274c Error al exportar PDF:",i),i}))}exportarExcel(e){console.log("\u{1f4ca} Exportando reporte a Excel...");const a=new _.Lr({"Content-Type":"application/json"});return this.http.post(`${this.apiUrl}/exportar/excel`,e,{headers:a,responseType:"blob"}).pipe((0,p.T)(i=>(console.log("\u2705 Excel generado exitosamente"),i)),(0,b.W)(i=>{throw console.error("\u274c Error al exportar Excel:",i),i}))}generarReportePorPeriodo(e,a){console.log(`\u{1f4c5} Generando reporte por per\xedodo: ${e} - ${a}`);const i=new Date(e);return this.generarReporteMensual(i.getMonth()+1,i.getFullYear())}generarReporteRapido(e){const a=new Date,i=a.getMonth()+1,r=a.getFullYear();switch(console.log(`\u26a1 Generando reporte r\xe1pido para per\xedodo: ${e}`),e){case"mes":case"trimestre":case"semana":default:return this.generarReporteMensual(i,r);case"a\xf1o":return this.generarReporteAnual(r)}}testConectividad(){return console.log("\u{1f527} Probando conectividad del servicio de reportes..."),this.http.get(`${this.apiUrl}/test`).pipe((0,p.T)(e=>(console.log("\u2705 Servicio de reportes funcionando:",e),e)),(0,b.W)(e=>(console.error("\u274c Error de conectividad:",e),(0,g.of)({error:"No se pudo conectar con el servicio de reportes"}))))}getNombreMes(e){return["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"][e-1]||"Mes Inv\xe1lido"}formatearMoneda(e){return new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0,maximumFractionDigits:0}).format(e)}getColorAlerta(e){switch(e){case"ERROR":return"#f44336";case"ADVERTENCIA":return"#ff9800";case"INFO":return"#2196f3";case"EXITO":return"#4caf50";default:return"#757575"}}getIconoAlerta(e){switch(e){case"ERROR":return"error";case"ADVERTENCIA":return"warning";case"INFO":return"info";case"EXITO":return"check_circle";default:return"help"}}static{this.\u0275fac=function(a){return new(a||n)(t.KVO(_.Qq))}}static{this.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var X=c(5567);const k=(n,o)=>({positivo:n,negativo:o}),J=(n,o)=>({"tipo-ingreso":n,"tipo-gasto":o}),q=(n,o)=>({"monto-ingreso":n,"monto-gasto":o}),Z=()=>["/fondos"],tt=()=>["/transacciones"];function et(n,o){1&n&&(t.j41(0,"div",16),t.nrm(1,"mat-spinner",17),t.j41(2,"p"),t.EFF(3,"Generando reportes financieros..."),t.k0s()()),2&n&&(t.R7$(),t.Y8G("diameter",50))}function at(n,o){if(1&n&&(t.j41(0,"mat-card",25)(1,"mat-card-header")(2,"mat-card-title")(3,"div",26)(4,"span"),t.EFF(5),t.k0s(),t.j41(6,"mat-chip",27),t.EFF(7),t.nI1(8,"titlecase"),t.k0s()()()(),t.j41(9,"mat-card-content")(10,"div",28)(11,"div",29)(12,"div",30)(13,"mat-icon"),t.EFF(14,"trending_up"),t.k0s()(),t.j41(15,"div",31)(16,"span",32),t.EFF(17,"Total Ingresos"),t.k0s(),t.j41(18,"span",33),t.EFF(19),t.nI1(20,"currency"),t.k0s()()(),t.j41(21,"div",34)(22,"div",30)(23,"mat-icon"),t.EFF(24,"trending_down"),t.k0s()(),t.j41(25,"div",31)(26,"span",32),t.EFF(27,"Total Gastos"),t.k0s(),t.j41(28,"span",33),t.EFF(29),t.nI1(30,"currency"),t.k0s()()(),t.j41(31,"div",35)(32,"div",30)(33,"mat-icon"),t.EFF(34),t.k0s()(),t.j41(35,"div",31)(36,"span",32),t.EFF(37,"Utilidad Neta"),t.k0s(),t.j41(38,"span",33),t.EFF(39),t.nI1(40,"currency"),t.k0s()()(),t.j41(41,"div",36)(42,"div",30)(43,"mat-icon"),t.EFF(44,"percent"),t.k0s()(),t.j41(45,"div",31)(46,"span",32),t.EFF(47,"Margen Utilidad"),t.k0s(),t.j41(48,"span",33),t.EFF(49),t.nI1(50,"number"),t.k0s()()(),t.j41(51,"div",37)(52,"div",30)(53,"mat-icon"),t.EFF(54,"account_balance_wallet"),t.k0s()(),t.j41(55,"div",31)(56,"span",32),t.EFF(57,"Patrimonio Total"),t.k0s(),t.j41(58,"span",33),t.EFF(59),t.nI1(60,"currency"),t.k0s()()()()()()),2&n){let e;const a=t.XpG(2);t.R7$(5),t.SpI("Indicadores Clave - ",a.dashboardData.periodo||(null==a.dashboardData.reporteMensual?null:a.dashboardData.reporteMensual.periodo),""),t.R7$(2),t.JRh(t.bMT(8,10,null==(e=a.filtrosForm.get("periodo"))?null:e.value)),t.R7$(12),t.JRh(t.ii3(20,12,a.dashboardData.kpis.totalIngresos,"COP","symbol","1.0-0")),t.R7$(10),t.JRh(t.ii3(30,17,a.dashboardData.kpis.totalGastos,"COP","symbol","1.0-0")),t.R7$(2),t.Y8G("ngClass",t.l_i(35,k,a.dashboardData.kpis.utilidadNeta>=0,a.dashboardData.kpis.utilidadNeta<0)),t.R7$(3),t.JRh(a.dashboardData.kpis.utilidadNeta>=0?"show_chart":"money_off"),t.R7$(5),t.JRh(t.ii3(40,22,a.dashboardData.kpis.utilidadNeta,"COP","symbol","1.0-0")),t.R7$(10),t.SpI("",t.i5U(50,27,a.dashboardData.kpis.margenUtilidad,"1.1-1"),"%"),t.R7$(2),t.Y8G("ngClass",t.l_i(38,k,a.dashboardData.kpis.sumaTotalFondos>=0,a.dashboardData.kpis.sumaTotalFondos<0)),t.R7$(8),t.JRh(t.ii3(60,30,a.dashboardData.kpis.sumaTotalFondos,"COP","symbol","1.0-0"))}}function nt(n,o){1&n&&(t.j41(0,"th",55),t.EFF(1,"Fondo"),t.k0s())}function it(n,o){if(1&n&&(t.j41(0,"td",56),t.EFF(1),t.k0s()),2&n){const e=o.$implicit;t.R7$(),t.JRh(e.nombre)}}function ot(n,o){1&n&&(t.j41(0,"th",55),t.EFF(1,"Balance Inicial"),t.k0s())}function rt(n,o){if(1&n&&(t.j41(0,"td",56),t.EFF(1),t.nI1(2,"currency"),t.k0s()),2&n){const e=o.$implicit;t.R7$(),t.JRh(t.ii3(2,1,e.balanceInicial,"COP","symbol","1.0-0"))}}function st(n,o){1&n&&(t.j41(0,"th",55),t.EFF(1,"Ingresos"),t.k0s())}function ct(n,o){if(1&n&&(t.j41(0,"td",57),t.EFF(1),t.nI1(2,"currency"),t.k0s()),2&n){const e=o.$implicit;t.R7$(),t.JRh(t.ii3(2,1,e.ingresos,"COP","symbol","1.0-0"))}}function dt(n,o){1&n&&(t.j41(0,"th",55),t.EFF(1,"Gastos"),t.k0s())}function lt(n,o){if(1&n&&(t.j41(0,"td",58),t.EFF(1),t.nI1(2,"currency"),t.k0s()),2&n){const e=o.$implicit;t.R7$(),t.JRh(t.ii3(2,1,e.gastos,"COP","symbol","1.0-0"))}}function mt(n,o){1&n&&(t.j41(0,"th",55),t.EFF(1,"Balance Final"),t.k0s())}function pt(n,o){if(1&n&&(t.j41(0,"td",59),t.EFF(1),t.nI1(2,"currency"),t.k0s()),2&n){const e=o.$implicit;t.Y8G("ngClass",t.l_i(7,k,e.balanceFinal>=0,e.balanceFinal<0)),t.R7$(),t.SpI(" ",t.ii3(2,2,e.balanceFinal,"COP","symbol","1.0-0")," ")}}function bt(n,o){1&n&&(t.j41(0,"th",55),t.EFF(1,"Transacciones"),t.k0s())}function ht(n,o){if(1&n&&(t.j41(0,"td",56),t.EFF(1),t.k0s()),2&n){const e=o.$implicit;t.R7$(),t.JRh(e.transacciones)}}function ut(n,o){1&n&&t.nrm(0,"tr",60)}function ft(n,o){1&n&&t.nrm(0,"tr",61)}function _t(n,o){if(1&n&&(t.j41(0,"mat-card",38)(1,"mat-card-header")(2,"mat-card-title"),t.EFF(3," Detalle de Fondos "),t.j41(4,"span",39),t.EFF(5),t.k0s()()(),t.j41(6,"mat-card-content")(7,"div",40)(8,"table",41),t.qex(9,42),t.DNE(10,nt,2,0,"th",43)(11,it,2,1,"td",44),t.bVm(),t.qex(12,45),t.DNE(13,ot,2,0,"th",43)(14,rt,3,6,"td",44),t.bVm(),t.qex(15,46),t.DNE(16,st,2,0,"th",43)(17,ct,3,6,"td",47),t.bVm(),t.qex(18,48),t.DNE(19,dt,2,0,"th",43)(20,lt,3,6,"td",49),t.bVm(),t.qex(21,50),t.DNE(22,mt,2,0,"th",43)(23,pt,3,10,"td",51),t.bVm(),t.qex(24,52),t.DNE(25,bt,2,0,"th",43)(26,ht,2,1,"td",44),t.bVm(),t.DNE(27,ut,1,0,"tr",53)(28,ft,1,0,"tr",54),t.k0s()()()()),2&n){const e=t.XpG(2);t.R7$(5),t.SpI("(",e.dashboardData.reporteMensual.resumen.transaccionesTotales," transacciones)"),t.R7$(3),t.Y8G("dataSource",e.dataSourceFondos),t.R7$(19),t.Y8G("matHeaderRowDef",e.displayedColumnsFondos),t.R7$(),t.Y8G("matRowDefColumns",e.displayedColumnsFondos)}}function gt(n,o){if(1&n&&(t.j41(0,"div",66)(1,"mat-icon"),t.EFF(2),t.k0s(),t.j41(3,"div",67)(4,"strong"),t.EFF(5),t.k0s(),t.j41(6,"span"),t.EFF(7),t.k0s()(),t.j41(8,"mat-chip",68),t.EFF(9),t.k0s()()),2&n){const e=o.$implicit,a=t.XpG(3);t.Y8G("ngClass","alerta-"+e.tipo.toLowerCase()),t.R7$(),t.xc7("color",a.getColorAlerta(e.tipo)),t.R7$(),t.JRh(a.getIconoAlerta(e.tipo)),t.R7$(3),t.JRh(e.fondo),t.R7$(2),t.JRh(e.mensaje),t.R7$(),t.xc7("background-color",a.getColorAlerta(e.tipo))("color","white"),t.R7$(),t.SpI(" ",e.prioridad," ")}}function xt(n,o){if(1&n&&(t.j41(0,"mat-card",62)(1,"mat-card-header")(2,"mat-card-title")(3,"mat-icon",63),t.EFF(4,"notifications_active"),t.k0s(),t.EFF(5),t.k0s()(),t.j41(6,"mat-card-content")(7,"div",64),t.DNE(8,gt,10,11,"div",65),t.k0s()()()),2&n){const e=t.XpG(2);t.R7$(5),t.SpI(" Alertas Activas (",e.dashboardData.alertas.length,") "),t.R7$(3),t.Y8G("ngForOf",e.dashboardData.alertas)}}function vt(n,o){1&n&&(t.j41(0,"th",55),t.EFF(1,"Fecha"),t.k0s())}function Ct(n,o){if(1&n&&(t.j41(0,"td",56),t.EFF(1),t.nI1(2,"date"),t.k0s()),2&n){const e=o.$implicit;t.R7$(),t.JRh(t.i5U(2,1,e.fecha,"dd/MM/yyyy"))}}function Tt(n,o){1&n&&(t.j41(0,"th",55),t.EFF(1,"Descripci\xf3n"),t.k0s())}function yt(n,o){if(1&n&&(t.j41(0,"span",82),t.EFF(1),t.k0s()),2&n){const e=t.XpG().$implicit;t.R7$(),t.JRh(e.fondo)}}function kt(n,o){if(1&n&&(t.j41(0,"td",56)(1,"div",79)(2,"span",80),t.EFF(3),t.k0s(),t.DNE(4,yt,2,1,"span",81),t.k0s()()),2&n){const e=o.$implicit;t.R7$(3),t.JRh(e.descripcion),t.R7$(),t.Y8G("ngIf",e.fondo)}}function It(n,o){1&n&&(t.j41(0,"th",55),t.EFF(1,"Categor\xeda"),t.k0s())}function Mt(n,o){if(1&n&&(t.j41(0,"td",56)(1,"mat-chip",83),t.EFF(2),t.k0s()()),2&n){const e=o.$implicit;t.R7$(2),t.JRh(e.categoria)}}function Et(n,o){1&n&&(t.j41(0,"th",55),t.EFF(1,"Tipo"),t.k0s())}function wt(n,o){if(1&n&&(t.j41(0,"td",56)(1,"mat-chip",84)(2,"mat-icon"),t.EFF(3),t.k0s(),t.EFF(4),t.nI1(5,"titlecase"),t.k0s()()),2&n){const e=o.$implicit;t.R7$(),t.Y8G("ngClass",t.l_i(5,J,"ingreso"===e.tipo,"gasto"===e.tipo)),t.R7$(2),t.JRh("ingreso"===e.tipo?"add":"remove"),t.R7$(),t.SpI(" ",t.bMT(5,3,e.tipo)," ")}}function Pt(n,o){1&n&&(t.j41(0,"th",55),t.EFF(1,"Monto"),t.k0s())}function Dt(n,o){if(1&n&&(t.j41(0,"td",59),t.EFF(1),t.nI1(2,"currency"),t.k0s()),2&n){const e=o.$implicit;t.Y8G("ngClass",t.l_i(8,q,"ingreso"===e.tipo,"gasto"===e.tipo)),t.R7$(),t.Lme(" ","ingreso"===e.tipo?"+":"-","",t.ii3(2,3,e.monto,"COP","symbol","1.0-0")," ")}}function Rt(n,o){1&n&&t.nrm(0,"tr",60)}function Ft(n,o){1&n&&t.nrm(0,"tr",61)}function At(n,o){1&n&&(t.j41(0,"div",85)(1,"p",86)(2,"mat-icon"),t.EFF(3,"info"),t.k0s(),t.EFF(4," Mostrando las \xfaltimas 50 transacciones del per\xedodo seleccionado. "),t.k0s()())}function Ot(n,o){if(1&n&&(t.j41(0,"mat-card",69)(1,"mat-card-header")(2,"mat-card-title")(3,"mat-icon"),t.EFF(4,"history"),t.k0s(),t.EFF(5," Historial de Transacciones "),t.j41(6,"span",70),t.EFF(7),t.k0s()()(),t.j41(8,"mat-card-content")(9,"div",71)(10,"table",72),t.qex(11,73),t.DNE(12,vt,2,0,"th",43)(13,Ct,3,4,"td",44),t.bVm(),t.qex(14,74),t.DNE(15,Tt,2,0,"th",43)(16,kt,5,2,"td",44),t.bVm(),t.qex(17,75),t.DNE(18,It,2,0,"th",43)(19,Mt,3,1,"td",44),t.bVm(),t.qex(20,76),t.DNE(21,Et,2,0,"th",43)(22,wt,6,8,"td",44),t.bVm(),t.qex(23,77),t.DNE(24,Pt,2,0,"th",43)(25,Dt,3,11,"td",51),t.bVm(),t.DNE(26,Rt,1,0,"tr",53)(27,Ft,1,0,"tr",54),t.k0s(),t.DNE(28,At,5,0,"div",78),t.k0s()()()),2&n){const e=t.XpG(2);t.R7$(7),t.SpI("(",e.dashboardData.historialTransacciones.length," \xfaltimas)"),t.R7$(3),t.Y8G("dataSource",e.dataSourceHistorial),t.R7$(16),t.Y8G("matHeaderRowDef",e.displayedColumnsHistorial),t.R7$(),t.Y8G("matRowDefColumns",e.displayedColumnsHistorial),t.R7$(),t.Y8G("ngIf",e.dashboardData.historialTransacciones.length>=50)}}function St(n,o){1&n&&(t.j41(0,"mat-card",87)(1,"mat-card-content")(2,"div",88)(3,"mat-icon",89),t.EFF(4,"info"),t.k0s(),t.j41(5,"div")(6,"h3"),t.EFF(7,"No hay datos para mostrar"),t.k0s(),t.j41(8,"p"),t.EFF(9,"No se encontraron datos financieros para el per\xedodo seleccionado."),t.k0s(),t.j41(10,"div",90)(11,"h4"),t.EFF(12,"Para comenzar a ver reportes:"),t.k0s(),t.j41(13,"ol")(14,"li")(15,"strong"),t.EFF(16,"Crea al menos un fondo"),t.k0s(),t.EFF(17,' en la secci\xf3n "Fondos"'),t.k0s(),t.j41(18,"li")(19,"strong"),t.EFF(20,"Registra transacciones"),t.k0s(),t.EFF(21," (ingresos o gastos) en tus fondos"),t.k0s(),t.j41(22,"li")(23,"strong"),t.EFF(24,"Regresa aqu\xed"),t.k0s(),t.EFF(25," para ver tus reportes financieros"),t.k0s()()(),t.j41(26,"div",91)(27,"button",92)(28,"mat-icon"),t.EFF(29,"account_balance"),t.k0s(),t.EFF(30," Ir a Fondos "),t.k0s()()()()()()),2&n&&(t.R7$(27),t.Y8G("routerLink",t.lJ4(1,Z)))}function Lt(n,o){if(1&n&&(t.j41(0,"mat-card",93)(1,"mat-card-content")(2,"div",94)(3,"mat-icon",95),t.EFF(4,"warning"),t.k0s(),t.j41(5,"div")(6,"h3"),t.EFF(7),t.k0s(),t.j41(8,"p"),t.EFF(9,"Tienes fondos activos, pero no hay transacciones registradas en el per\xedodo seleccionado. Puedes registrar una nueva transacci\xf3n o seleccionar un per\xedodo diferente en el filtro de arriba."),t.k0s(),t.j41(10,"div",96)(11,"button",97)(12,"mat-icon"),t.EFF(13,"add"),t.k0s(),t.EFF(14," Registrar transacci\xf3n "),t.k0s()()()()()()),2&n){const e=t.XpG(2);t.R7$(7),t.SpI("Sin transacciones en ",e.dashboardData.reporteMensual.periodo,""),t.R7$(4),t.Y8G("routerLink",t.lJ4(2,tt))}}function Bt(n,o){if(1&n&&(t.j41(0,"div",18),t.DNE(1,at,61,41,"mat-card",19)(2,_t,29,4,"mat-card",20)(3,xt,9,2,"mat-card",21)(4,Ot,29,5,"mat-card",22)(5,St,31,2,"mat-card",23)(6,Lt,15,3,"mat-card",24),t.k0s()),2&n){const e=t.XpG();t.R7$(),t.Y8G("ngIf",e.dashboardData),t.R7$(),t.Y8G("ngIf",null==e.dashboardData?null:e.dashboardData.reporteMensual),t.R7$(),t.Y8G("ngIf",(null==e.dashboardData?null:e.dashboardData.alertas)&&e.dashboardData.alertas.length>0),t.R7$(),t.Y8G("ngIf",(null==e.dashboardData?null:e.dashboardData.historialTransacciones)&&e.dashboardData.historialTransacciones.length>0),t.R7$(),t.Y8G("ngIf",!e.dashboardData),t.R7$(),t.Y8G("ngIf",e.dashboardData&&e.dashboardData.reporteMensual&&0===e.dashboardData.reporteMensual.resumen.transaccionesTotales)}}let Nt=(()=>{class n{constructor(e,a,i){this.fb=e,this.reportesService=a,this.notificationService=i,this.destroy$=new W.B,this.cargando=!1,this.dashboardData=null,this.dataSourceFondos=new m.I6,this.dataSourceHistorial=new m.I6,this.displayedColumnsFondos=["nombre","balanceInicial","ingresos","gastos","balanceFinal","transacciones"],this.displayedColumnsHistorial=["fecha","descripcion","categoria","tipo","monto"],this.filtrosForm=this.fb.group({periodo:["mes"]}),this.filtrosForm.get("periodo")?.valueChanges.pipe((0,T.Q)(this.destroy$)).subscribe(r=>{console.log(`\u{1f504} Per\xedodo cambiado a: ${r}`),setTimeout(()=>{this.cargarDashboard()},100)})}ngOnInit(){console.log("\u{1f680} Iniciando componente de reportes financieros..."),this.cargarDashboard()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}cargarDashboard(){const e=this.filtrosForm.get("periodo")?.value;console.log(`\u{1f4ca} Cargando dashboard para per\xedodo: ${e}`),this.cargando=!0,this.dashboardData=null,this.reportesService.obtenerDashboard(e).pipe((0,T.Q)(this.destroy$)).subscribe({next:a=>{console.log("\u{1f4ca} Datos recibidos del dashboard:",a),a&&a.reporteMensual?(this.dashboardData=a,a.reporteMensual?.fondos&&Array.isArray(a.reporteMensual.fondos)?(this.dataSourceFondos.data=a.reporteMensual.fondos,console.log(`\u{1f4cb} Tabla configurada con ${a.reporteMensual.fondos.length} fondos`)):(this.dataSourceFondos.data=[],console.log("\u{1f4cb} No hay fondos para mostrar en la tabla")),a.historialTransacciones&&Array.isArray(a.historialTransacciones)?(this.dataSourceHistorial.data=a.historialTransacciones,console.log(`\u{1f4c8} Historial configurado con ${a.historialTransacciones.length} transacciones`)):(this.dataSourceHistorial.data=[],console.log("\u{1f4c8} No hay transacciones para mostrar en el historial")),console.log("\u2705 Dashboard cargado exitosamente:",this.dashboardData),0===a.reporteMensual.resumen.transaccionesTotales?this.notificationService.info("Dashboard cargado - No hay transacciones en el per\xedodo seleccionado"):this.notificationService.success(`Dashboard actualizado - ${a.reporteMensual.resumen.transaccionesTotales} transacciones encontradas`)):(console.warn("\u26a0\ufe0f No se recibieron datos v\xe1lidos del dashboard"),this.dashboardData=null,this.dataSourceFondos.data=[],this.notificationService.warning("No hay datos disponibles para mostrar")),this.cargando=!1},error:a=>{console.error("\u274c Error al cargar dashboard:",a),console.error("\u274c Error details:",a.error),this.cargando=!1,this.dashboardData=null,this.dataSourceFondos.data=[],this.dataSourceHistorial.data=[];let i="Error al cargar los reportes financieros";401===a.status?i="Sesi\xf3n expirada. Por favor, inicia sesi\xf3n nuevamente":500===a.status&&(i="Error interno del servidor. Int\xe9ntalo m\xe1s tarde"),this.notificationService.error(i)}})}exportarPDF(){console.log("\u{1f4c4} Exportando reporte a PDF..."),this.reportesService.exportarPDF({periodo:this.filtrosForm.get("periodo")?.value}).pipe((0,T.Q)(this.destroy$)).subscribe({next:e=>{const a=window.URL.createObjectURL(e),i=document.createElement("a");i.href=a,i.download=`reporte-financiero-${(new Date).toISOString().split("T")[0]}.pdf`,i.click(),window.URL.revokeObjectURL(a),this.notificationService.success("Reporte PDF descargado exitosamente")},error:e=>{console.error("\u274c Error al exportar PDF:",e),this.notificationService.error("Error al generar el PDF")}})}exportarExcel(){console.log("\u{1f4ca} Exportando reporte a Excel..."),this.reportesService.exportarExcel({periodo:this.filtrosForm.get("periodo")?.value}).pipe((0,T.Q)(this.destroy$)).subscribe({next:e=>{const a=window.URL.createObjectURL(e),i=document.createElement("a");i.href=a,i.download=`reporte-financiero-${(new Date).toISOString().split("T")[0]}.xlsx`,i.click(),window.URL.revokeObjectURL(a),this.notificationService.success("Reporte Excel descargado exitosamente")},error:e=>{console.error("\u274c Error al exportar Excel:",e),this.notificationService.error("Error al generar el Excel")}})}getColorAlerta(e){return this.reportesService.getColorAlerta(e)}getIconoAlerta(e){return this.reportesService.getIconoAlerta(e)}tieneDatosSignificativos(){return this.dashboardData&&this.dashboardData.reporteMensual&&this.dashboardData.reporteMensual.resumen.transaccionesTotales>0}static{this.\u0275fac=function(a){return new(a||n)(t.rXU(u.ok),t.rXU(K),t.rXU(X.J))}}static{this.\u0275cmp=t.VBU({type:n,selectors:[["app-reportes"]],standalone:!0,features:[t.aNF],decls:41,vars:5,consts:[["exportMenu","matMenu"],[1,"reportes-container"],[1,"header-section"],[1,"title-section"],[1,"controls-section"],[1,"filtros-form",3,"formGroup"],["appearance","outline"],["formControlName","periodo"],["value","semana"],["value","mes"],["value","trimestre"],["value","a\xf1o"],["mat-stroked-button","",3,"matMenuTriggerFor","disabled"],["mat-menu-item","",3,"click"],["class","loading-container",4,"ngIf"],["class","main-content",4,"ngIf"],[1,"loading-container"],[3,"diameter"],[1,"main-content"],["class","kpis-card",4,"ngIf"],["class","tabla-reportes-card",4,"ngIf"],["class","alertas-card",4,"ngIf"],["class","historial-card",4,"ngIf"],["class","info-card",4,"ngIf"],["class","warning-card",4,"ngIf"],[1,"kpis-card"],[1,"kpi-header"],[1,"periodo-chip"],[1,"kpis-grid"],[1,"kpi-item","ingresos"],[1,"kpi-icon"],[1,"kpi-content"],[1,"kpi-label"],[1,"kpi-value"],[1,"kpi-item","gastos"],[1,"kpi-item","utilidad",3,"ngClass"],[1,"kpi-item","margen"],[1,"kpi-item","patrimonio",3,"ngClass"],[1,"tabla-reportes-card"],[1,"tabla-subtitle"],[1,"tabla-container"],["mat-table","",1,"fondos-table",3,"dataSource"],["matColumnDef","nombre"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","balanceInicial"],["matColumnDef","ingresos"],["mat-cell","","class","ingresos",4,"matCellDef"],["matColumnDef","gastos"],["mat-cell","","class","gastos",4,"matCellDef"],["matColumnDef","balanceFinal"],["mat-cell","",3,"ngClass",4,"matCellDef"],["matColumnDef","transacciones"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],["mat-cell","",1,"ingresos"],["mat-cell","",1,"gastos"],["mat-cell","",3,"ngClass"],["mat-header-row",""],["mat-row",""],[1,"alertas-card"],[1,"alerta-icon"],[1,"alertas-lista"],["class","alerta-item",3,"ngClass",4,"ngFor","ngForOf"],[1,"alerta-item",3,"ngClass"],[1,"alerta-content"],[1,"prioridad-chip"],[1,"historial-card"],[1,"historial-subtitle"],[1,"historial-container"],["mat-table","",1,"historial-table",3,"dataSource"],["matColumnDef","fecha"],["matColumnDef","descripcion"],["matColumnDef","categoria"],["matColumnDef","tipo"],["matColumnDef","monto"],["class","historial-footer",4,"ngIf"],[1,"transaccion-descripcion"],[1,"descripcion-principal"],["class","fondo-nombre",4,"ngIf"],[1,"fondo-nombre"],[1,"categoria-chip"],[3,"ngClass"],[1,"historial-footer"],[1,"footer-text"],[1,"info-card"],[1,"info-content"],[1,"info-icon"],[1,"info-steps"],[1,"info-actions"],["mat-stroked-button","","color","accent",3,"routerLink"],[1,"warning-card"],[1,"warning-content"],[1,"warning-icon"],[1,"warning-actions"],["mat-raised-button","","color","primary",3,"routerLink"]],template:function(a,i){if(1&a){const r=t.RV6();t.j41(0,"div",1)(1,"div",2)(2,"div",3)(3,"h1")(4,"mat-icon"),t.EFF(5,"assessment"),t.k0s(),t.EFF(6," Reportes Financieros"),t.k0s(),t.j41(7,"p"),t.EFF(8,"Panel completo de an\xe1lisis y reportes financieros"),t.k0s()(),t.j41(9,"div",4)(10,"form",5)(11,"mat-form-field",6)(12,"mat-label"),t.EFF(13,"Per\xedodo"),t.k0s(),t.j41(14,"mat-select",7)(15,"mat-option",8),t.EFF(16,"Esta Semana"),t.k0s(),t.j41(17,"mat-option",9),t.EFF(18,"Este Mes"),t.k0s(),t.j41(19,"mat-option",10),t.EFF(20,"Este Trimestre"),t.k0s(),t.j41(21,"mat-option",11),t.EFF(22,"Este A\xf1o"),t.k0s()()(),t.j41(23,"button",12)(24,"mat-icon"),t.EFF(25,"download"),t.k0s(),t.EFF(26," Exportar "),t.k0s(),t.j41(27,"mat-menu",null,0)(29,"button",13),t.bIt("click",function(){return t.eBV(r),t.Njj(i.exportarPDF())}),t.j41(30,"mat-icon"),t.EFF(31,"picture_as_pdf"),t.k0s(),t.j41(32,"span"),t.EFF(33,"Exportar PDF"),t.k0s()(),t.j41(34,"button",13),t.bIt("click",function(){return t.eBV(r),t.Njj(i.exportarExcel())}),t.j41(35,"mat-icon"),t.EFF(36,"table_chart"),t.k0s(),t.j41(37,"span"),t.EFF(38,"Exportar Excel"),t.k0s()()()()()(),t.DNE(39,et,4,1,"div",14)(40,Bt,7,6,"div",15),t.k0s()}if(2&a){const r=t.sdS(28);t.R7$(10),t.Y8G("formGroup",i.filtrosForm),t.R7$(13),t.Y8G("matMenuTriggerFor",r)("disabled",i.cargando),t.R7$(16),t.Y8G("ngIf",i.cargando),t.R7$(),t.Y8G("ngIf",!i.cargando)}},dependencies:[h.MD,h.YU,h.Sq,h.bT,h.QX,h.PV,h.oe,h.vh,M.iI,M.Wk,u.YN,u.qT,u.BC,u.cb,u.X1,u.j4,u.JD,x.Hu,x.RN,x.m2,x.MM,x.dh,E.Hl,E.$z,w.m_,w.An,y.RG,y.rl,y.nJ,P.Ve,P.VO,v.wT,S.X6,v.WX,$,m.tP,m.Zl,m.tL,m.ji,m.cC,m.YV,m.iL,m.KS,m.$R,m.YZ,m.NB,D.D6,D.LG,z,F.YN,F.Jl,Q.Fe,U.PO,C.Cn,C.kk,C.fb,C.Cp],styles:[".reportes-container[_ngcontent-%COMP%]{max-width:1400px;margin:0 auto;padding:20px;background-color:#f5f5f5}.header-section[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:24px;background:#fff;padding:24px;border-radius:12px;box-shadow:0 2px 8px #0000001a}.title-section[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;display:flex;align-items:center;gap:12px;color:#1976d2;font-size:2rem}.title-section[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:8px 0 0;color:#666;font-size:1rem}.filtros-form[_ngcontent-%COMP%]{display:flex;gap:16px;align-items:center}.filtros-form[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{min-width:180px}.loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:200px;background:#fff;border-radius:12px;margin-bottom:24px}.loading-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-top:16px;color:#666}.main-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:24px}.kpis-card[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;border-radius:16px;overflow:hidden}.kpis-card[_ngcontent-%COMP%]   mat-card-header[_ngcontent-%COMP%]{background:#ffffff1a;padding:16px 24px}.kpi-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;width:100%}.periodo-chip[_ngcontent-%COMP%]{background-color:#fff3;color:#fff;font-weight:600;font-size:.8rem}.kpis-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;padding:24px;max-width:1200px;margin:0 auto}.kpi-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px;background:#ffffff1a;padding:20px;border-radius:12px;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);transition:transform .2s ease}.kpi-item[_ngcontent-%COMP%]:hover{transform:translateY(-4px);background:#ffffff26}.kpi-icon[_ngcontent-%COMP%]{width:48px;height:48px;border-radius:50%;display:flex;align-items:center;justify-content:center;background:#fff3}.kpi-icon[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:24px;width:24px;height:24px}.kpi-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1}.kpi-label[_ngcontent-%COMP%]{font-size:.9rem;opacity:.9;margin-bottom:4px}.kpi-value[_ngcontent-%COMP%]{font-size:1.4rem;font-weight:600;line-height:1.2}.kpi-item.patrimonio[_ngcontent-%COMP%]{background:#ffffff26;border-left:3px solid rgba(255,215,0,.8)}.kpi-item.patrimonio[_ngcontent-%COMP%]:hover{background:#ffd7001a;transform:translateY(-4px)}.kpi-item.patrimonio[_ngcontent-%COMP%]   .kpi-icon[_ngcontent-%COMP%]{background:#ffd70033}.kpi-item.patrimonio[_ngcontent-%COMP%]   .kpi-icon[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:gold}.alertas-card[_ngcontent-%COMP%]{border-left:4px solid #ff9800}.alerta-icon[_ngcontent-%COMP%]{color:#ff9800;margin-right:8px}.alertas-lista[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.alerta-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;padding:12px;border-radius:8px;background-color:#00000005;border:1px solid rgba(0,0,0,.05)}.alerta-content[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;gap:4px}.alerta-content[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-weight:600;color:#333}.alerta-content[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#666;font-size:.9rem}.prioridad-chip[_ngcontent-%COMP%]{font-size:.8rem;font-weight:500}.tabla-container[_ngcontent-%COMP%]{overflow-x:auto}.fondos-table[_ngcontent-%COMP%]{width:100%}.fondos-table[_ngcontent-%COMP%]   .ingresos[_ngcontent-%COMP%]{color:#4caf50;font-weight:500}.fondos-table[_ngcontent-%COMP%]   .gastos[_ngcontent-%COMP%]{color:#f44336;font-weight:500}.fondos-table[_ngcontent-%COMP%]   .positivo[_ngcontent-%COMP%]{color:#4caf50;font-weight:600}.fondos-table[_ngcontent-%COMP%]   .negativo[_ngcontent-%COMP%]{color:#f44336;font-weight:600}.tabla-subtitle[_ngcontent-%COMP%]{font-size:.9rem;font-weight:400;color:#666;margin-left:8px}.historial-card[_ngcontent-%COMP%]{border-left:4px solid #2196f3}.historial-card[_ngcontent-%COMP%]   mat-card-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.historial-subtitle[_ngcontent-%COMP%]{font-size:.9rem;font-weight:400;color:#666;margin-left:8px}.historial-container[_ngcontent-%COMP%]{overflow-x:auto}.historial-table[_ngcontent-%COMP%]{width:100%}.transaccion-descripcion[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.descripcion-principal[_ngcontent-%COMP%]{font-weight:500;color:#333}.fondo-nombre[_ngcontent-%COMP%]{font-size:.8rem;color:#666;font-style:italic}.categoria-chip[_ngcontent-%COMP%]{background-color:#e0e0e0;color:#333;font-size:.8rem}.tipo-ingreso[_ngcontent-%COMP%]{background-color:#4caf50;color:#fff}.tipo-gasto[_ngcontent-%COMP%]{background-color:#f44336;color:#fff}.tipo-ingreso[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%], .tipo-gasto[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:16px;width:16px;height:16px;margin-right:4px}.monto-ingreso[_ngcontent-%COMP%]{color:#4caf50;font-weight:600}.monto-gasto[_ngcontent-%COMP%]{color:#f44336;font-weight:600}.historial-footer[_ngcontent-%COMP%]{margin-top:16px;padding:12px;background-color:#f5f5f5;border-radius:8px;border-left:3px solid #2196f3}.footer-text[_ngcontent-%COMP%]{margin:0;display:flex;align-items:center;gap:8px;color:#666;font-size:.9rem}.footer-text[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#2196f3;font-size:18px;width:18px;height:18px}.info-card[_ngcontent-%COMP%]{border-left:4px solid #2196f3}.info-content[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:16px}.info-icon[_ngcontent-%COMP%]{color:#2196f3;font-size:32px;width:32px;height:32px;margin-top:4px}.info-content[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 8px;color:#2196f3}.info-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 12px}.info-steps[_ngcontent-%COMP%]{margin:16px 0;padding:16px;background-color:#f8f9fa;border-radius:8px;border-left:3px solid #2196f3}.info-steps[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 12px;color:#333;font-size:1.1rem}.info-steps[_ngcontent-%COMP%]   ol[_ngcontent-%COMP%]{margin:0;padding-left:20px}.info-steps[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-bottom:8px;line-height:1.4}.info-actions[_ngcontent-%COMP%]{display:flex;gap:12px;flex-wrap:wrap}.warning-card[_ngcontent-%COMP%]{border-left:4px solid #ff9800;background:linear-gradient(135deg,#fff8e1,#fffbf0)}.warning-content[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:16px}.warning-icon[_ngcontent-%COMP%]{color:#ff9800;font-size:32px;width:32px;height:32px;margin-top:4px}.warning-content[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 8px;color:#ff9800}.warning-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 16px;color:#666}.warning-actions[_ngcontent-%COMP%]{display:flex;gap:12px;flex-wrap:wrap}@media (max-width: 768px){.reportes-container[_ngcontent-%COMP%]{padding:16px}.header-section[_ngcontent-%COMP%]{flex-direction:column;gap:16px}.filtros-form[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}.filtros-form[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{min-width:auto}.kpis-grid[_ngcontent-%COMP%]{grid-template-columns:1fr;padding:16px}.charts-section[_ngcontent-%COMP%]{grid-template-columns:1fr}.info-content[_ngcontent-%COMP%], .warning-content[_ngcontent-%COMP%]{flex-direction:column;align-items:center;text-align:center}.info-actions[_ngcontent-%COMP%], .warning-actions[_ngcontent-%COMP%]{justify-content:center}.info-steps[_ngcontent-%COMP%]{text-align:left;width:100%}}"]})}}return n})()}}]);